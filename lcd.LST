C51 COMPILER V9.54   LCD                                                                   06/11/2017 07:58:42 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE LCD
OBJECT MODULE PLACED IN lcd.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\c51.exe lcd.c DB OE BR INCDIR(C:\SiLabs\MCU\Inc)

line level    source

   1          #include "lcd.h"
   2          #include "C8051F120.h"
   3          #include "ports.h"
   4          
   5          
   6          //============================================================================
   7          //============================================================================
   8          void write_command(unsigned char ldata)
   9          {
  10   1        P2 = ldata;
  11   1        LCD_DI = 0; //DI = 0
  12   1        LCD_RW = 0; //RW = 0
  13   1        LCD_EN = 1;  //EN = 1
  14   1        LCD_EN = 0;  //EN = 0
  15   1        _delay_us(850);
  16   1        LCD_EN = 1;  //EN = 1
  17   1      }
  18          //----------------------------------------------------------------------------
  19          void write_data(unsigned char ldata)
  20          {
  21   1        P2 = ldata;
  22   1        LCD_DI = 1; //DI = 1
  23   1        LCD_RW = 0; //RW = 0
  24   1        LCD_EN = 1;  //EN = 1
  25   1        LCD_EN = 0;   //EN = 0
  26   1        _delay_us(850);
  27   1        LCD_EN = 1;   //EN = 1
  28   1      }
  29          //----------------------------------------------------------------------------
  30          void write_data_16(unsigned int ldata)
  31          {
  32   1        P2 = ldata>>8;
  33   1              
  34   1        LCD_DI = 1;   //DI = 1
  35   1        LCD_RW = 1;   //RW = 1
  36   1        LCD_EN = 1;   //EN = 1
  37   1        LCD_EN = 0;   //EN = 0
  38   1        _delay_us(850);
  39   1        LCD_EN = 1;   //EN = 1
  40   1        P2 = ldata;
  41   1        LCD_EN = 0;   //EN = 0
  42   1        _delay_us(850);
  43   1        LCD_EN = 1;   //EN = 1
  44   1      }
  45          //----------------------------------------------------------------------------
  46          void Clear_LCD(void)
  47          {
  48   1              write_command(0x38);
  49   1              write_command(0x38);
  50   1              write_command(0x38);
  51   1          write_command(0x38);        // установить 8-ми битный режим
  52   1          write_command(0x0A);        // cursor on
  53   1          write_command(0x01);        // очистка дисплея
  54   1          write_command(0x06);        // 0x06 курсор вправо, 0x04 курсор влево
  55   1          //write_command(0x0F);      // включить курсор и мигать
C51 COMPILER V9.54   LCD                                                                   06/11/2017 07:58:42 PAGE 2   

  56   1          write_command(0x0B);
  57   1              write_command(0x01);    // очистка дисплея
  58   1      
  59   1      }
  60          //----------------------------------------------------------------------------
  61          //
  62          void Write_Char (unsigned char pos, unsigned char ldata)
  63          {
  64   1              write_command(0x14);
  65   1              write_command(0x14);
  66   1              write_command(0x14);
  67   1              write_command(0x80+pos);
  68   1              write_data(ldata);              
  69   1      }
  70          //============================================================================
  71          void ResetLCD(void)
  72          {
  73   1           LCDRST = 0; //RST = 0
  74   1              _delay_us(6500);
  75   1                      _delay_us(6500);    
  76   1                      _delay_us(6500);
  77   1                      _delay_us(6500);
  78   1                      _delay_us(6500);
  79   1                      _delay_us(6500);
  80   1           LCDRST = 1; //RST = 1
  81   1      }
  82          
  83          //============================================================================
  84          void InitializeLCD(void)
  85          {
  86   1              /* Take the LCD out of reset (if reset was low)
  87   1              */
  88   1              LCDRST = 1; //RST = 1
  89   1      
  90   1              _delay_us(6500);
  91   1      
  92   1              //Display on
  93   1              write_command(0x30); //8 bit
  94   1              write_command(0x0F); //On and blink cursor
  95   1              write_command(0x30); //8 bit
  96   1              write_command(0x01); //clear scr
  97   1              write_command(0x06); //direct cursor
  98   1              //write_command(0x32);
  99   1              //write_command(0x36);
 100   1      
 101   1      }
 102          //============================================================================
 103          void _delay_us(int ms)
 104          {
 105   1              int i;
 106   1              while (ms>0){
 107   2                      for (i = 3; i > 0; i--);
 108   2                      ms--;
 109   2              }
 110   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    246    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.54   LCD                                                                   06/11/2017 07:58:42 PAGE 3   

   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
