#include "encoder.h"

//это для наглядности кода
#define b00000011 3
#define b11010010 210
#define b11100001 225

volatile unsigned char bufEnc = 0; //буфер энкодера

//функция опроса энкодера
//___________________________________________
bool ENC_PollEncoder(void)
{
static unsigned char stateEnc; 	//хранит последовательность состояний энкодера
unsigned char tmp;  
unsigned char currentState = 0;

//проверяем состояние выводов микроконтроллера
if (ENC_A != 0) {currentState |= (1<<0);}
if (ENC_C != 0) {currentState |= (1<<1);}

//если равно предыдущему, то выходим
tmp = stateEnc;
if (currentState == (tmp & b00000011)) return false;

//если не равно, то сдвигаем и сохраняем в озу
tmp = (tmp<<2)|currentState;
stateEnc = tmp;

//сравниваем получившуюся последовательность
if (tmp == b11100001) bufEnc = LEFT_SPIN;
if (tmp == b11010010) bufEnc = RIGHT_SPIN;
return true;
}

//функция возвращающая значение буфера энкодера
//_____________________________________________
unsigned char ENC_GetStateEncoder(void)
{
  unsigned char tmp = bufEnc;
  bufEnc = 0;
  return tmp;
}


